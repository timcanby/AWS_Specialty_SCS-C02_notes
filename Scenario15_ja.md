<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**

- [AWS Organizations × IAM Identity Center（SSO）によるリージョン・サービス制限設計ドキュメント](#aws-organizations-%C3%97-iam-identity-centersso%E3%81%AB%E3%82%88%E3%82%8B%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%83%BB%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E5%88%B6%E9%99%90%E8%A8%AD%E8%A8%88%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88)
  - [📘 シナリオ](#-%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA)
  - [✅ 最適な対応策](#-%E6%9C%80%E9%81%A9%E3%81%AA%E5%AF%BE%E5%BF%9C%E7%AD%96)
    - [**C. サービスコントロールポリシー（SCP）により、リージョンおよびサービス制限を実施**](#c-%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BCscp%E3%81%AB%E3%82%88%E3%82%8A%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8A%E3%82%88%E3%81%B3%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E5%88%B6%E9%99%90%E3%82%92%E5%AE%9F%E6%96%BD)
  - [🚫 他の選択肢の課題](#-%E4%BB%96%E3%81%AE%E9%81%B8%E6%8A%9E%E8%82%A2%E3%81%AE%E8%AA%B2%E9%A1%8C)
  - [🧠 補足知識：SCP（サービスコントロールポリシー）による制限とその利点](#-%E8%A3%9C%E8%B6%B3%E7%9F%A5%E8%AD%98scp%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%AB%E3%82%88%E3%82%8B%E5%88%B6%E9%99%90%E3%81%A8%E3%81%9D%E3%81%AE%E5%88%A9%E7%82%B9)
    - [🔐 SCP（Service Control Policy）とは？](#-scpservice-control-policy%E3%81%A8%E3%81%AF)
    - [✅ SCP の特長](#-scp-%E3%81%AE%E7%89%B9%E9%95%B7)
  - [🌍 リージョン制限の具体的な書き方（SCP 例）](#-%E3%83%AA%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E5%88%B6%E9%99%90%E3%81%AE%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E6%9B%B8%E3%81%8D%E6%96%B9scp-%E4%BE%8B)
  - [🧰 IAM ポリシーや Identity Center による制御との違い](#-iam-%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%84-identity-center-%E3%81%AB%E3%82%88%E3%82%8B%E5%88%B6%E5%BE%A1%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84)
  - [✅ 推奨構成パターン](#-%E6%8E%A8%E5%A5%A8%E6%A7%8B%E6%88%90%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3)
  - [📘 設定例](#-%E8%A8%AD%E5%AE%9A%E4%BE%8B)
    - [✅ ステップ2：AWS Organizations を使ったマルチアカウント構成の導入](#-%E3%82%B9%E3%83%86%E3%83%83%E3%83%972aws-organizations-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%9E%E3%83%AB%E3%83%81%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E6%A7%8B%E6%88%90%E3%81%AE%E5%B0%8E%E5%85%A5)
  - [✅ ステップ5：CloudTrail ＆ GuardDuty による監視の有効化](#-%E3%82%B9%E3%83%86%E3%83%83%E3%83%975cloudtrail-%EF%BC%86-guardduty-%E3%81%AB%E3%82%88%E3%82%8B%E7%9B%A3%E8%A6%96%E3%81%AE%E6%9C%89%E5%8A%B9%E5%8C%96)
  - [✅ ステップ6：コストと予算の制御](#-%E3%82%B9%E3%83%86%E3%83%83%E3%83%976%E3%82%B3%E3%82%B9%E3%83%88%E3%81%A8%E4%BA%88%E7%AE%97%E3%81%AE%E5%88%B6%E5%BE%A1)
  - [✅ ステップ7：ベストプラクティスとおすすめ設定](#-%E3%82%B9%E3%83%86%E3%83%83%E3%83%977%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9%E3%81%A8%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E8%A8%AD%E5%AE%9A)
  - [📌 まとめ：初期導入構成テンプレート](#-%E3%81%BE%E3%81%A8%E3%82%81%E5%88%9D%E6%9C%9F%E5%B0%8E%E5%85%A5%E6%A7%8B%E6%88%90%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->


# AWS Organizations × IAM Identity Center（SSO）によるリージョン・サービス制限設計ドキュメント

---

## 📘 シナリオ

ある企業は、開発チームごとに AWS アカウントを分離し、**AWS Organizations** と **IAM Identity Center（旧 SSO）** を活用してマルチアカウント構成を設計中。  
要件は以下のとおり：

- 各開発チームは **使用可能な AWS リージョンを限定**する必要がある  
- 各アカウントでは **特定の AWS サービスのみを利用可能**にする必要がある  
- 管理者の **運用負荷を最小限に抑える**ことが重要

---

## ✅ 最適な対応策

### **C. サービスコントロールポリシー（SCP）により、リージョンおよびサービス制限を実施**

| 理由 | 説明 |
|------|------|
| ✅ 組織単位での制御が可能 | SCP は OU（組織単位）単位で制限を一元管理できるため、全アカウントに共通適用可能 |
| ✅ Identity Center や IAM ポリシーより上位の強制力 | IAM ポリシーやロール設定よりも優先され、**明示的にブロック**できる |
| ✅ リージョン・サービス両方に適用可能 | `Condition` や `NotAction` を使うことで、使用可能なサービスやリージョンを明確に制御可能 |
| ✅ スケーラブル | 新しいアカウントを OU に追加するだけで自動的に制限が適用される

---

## 🚫 他の選択肢の課題

| 選択肢 | 問題点 |
|--------|--------|
| A. Identity Center でのポリシー設定 | 各アカウント・各ロールごとに個別設定が必要になり、管理負荷が高い |
| B. STS のリージョン単位無効化 | 無効化は限定的で一部サービスにしか適用できず、全体的な制御としては不十分 |
| D. Identity Center 用のカスタム IAM ポリシーを各アカウントに設定 | アカウント数が増えると運用負荷が急増し、統一的な管理が難しい |

---

## 🧠 補足知識：SCP（サービスコントロールポリシー）による制限とその利点

### 🔐 SCP（Service Control Policy）とは？

SCP は AWS Organizations における **上位レベルのアクセスコントロールメカニズム** です。  
各アカウントにおける IAM ポリシーの上位で作用し、**「そのアカウントで許可できる最大のアクセス範囲」を定義**します。

### ✅ SCP の特長

| 特性 | 説明 |
|------|------|
| 強制力 | IAM ポリシーで明示的に許可されていても、SCP でブロックされていれば実行不可 |
| OU（組織単位）適用 | OU に SCP をアタッチすることで、配下のすべてのアカウントに適用 |
| 一元管理 | アカウントごとの細かな設定をせずに、共通ルールを集中制御できる |
| 安全性 | 誤設定による過剰権限付与のリスクを大幅に削減できる |
| 条件指定可能 | `Condition` を使ってリージョンやサービスなどでフィルタリング可能 |

---

## 🌍 リージョン制限の具体的な書き方（SCP 例）

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowOnlySpecificRegions",
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": {
        "StringNotEquals": {
          "aws:RequestedRegion": ["ap-northeast-1", "us-west-2"]
        }
      }
    }
  ]
}
```

このポリシーでは、`ap-northeast-1`（東京）と `us-west-2`（オレゴン）以外のリージョンでの全操作を拒否します。

---

## 🧰 IAM ポリシーや Identity Center による制御との違い

| 比較項目 | SCP | IAM ポリシー（Identity Center） |
|-----------|-----|-----------------------------|
| 管理単位 | OU 単位（組織全体） | アカウント × ユーザー/ロール単位 |
| スケーラビリティ | 非常に高い（OU追加で即時反映） | アカウント増加ごとに個別設定必要 |
| 制限方式 | 最大許可範囲の定義（Allow/Deny） | 明示的な許可操作（Allow）ベース |
| 適用範囲 | 全サービス・全 API を対象に適用可能 | IAM ポリシーで許可された範囲内のみ有効 |
| 利用の推奨範囲 | 組織全体の制限・ガバナンス | 特定ユーザー・ロールの権限定義に有効 |

---

## ✅ 推奨構成パターン

- **リージョンやサービス制限のような統一ルールは SCP で制御**
- **ユーザーごとのアクセス範囲は IAM Identity Center の権限セット（Permission Set）で管理**
- **2層構造（SCP + Identity Center）でセキュリティ強化と運用効率を両立**

## 📘 設定例

あなたは IT 開発会社に新しく入社したシステム管理者であり、**会社用の AWS アカウントを今日初めて作成したばかり**です。  
本ドキュメントでは、会社の AWS 利用を安全・効率的に開始するために、最初に行うべきステップを一つずつ例付きで解説します。

---

###✅ ステップ1：ルートユーザーの保護と初期設定

| 作業内容 | 説明 |
|----------|------|
| ルートユーザー MFA 有効化 | セキュリティ上必須。仮想 MFA アプリ（Google Authenticatorなど）で有効化 |
| ルートでの日常利用を避ける | ルートは緊急時専用。IAMユーザーや IAM Identity Center を使う |
| 連絡先情報と支払い情報の登録 | 「アカウント設定」から会社の正式情報を入力 |

---

### ✅ ステップ2：AWS Organizations を使ったマルチアカウント構成の導入

```bash
1. AWS Organizations にアクセス
2. 新しい組織を作成
3. 開発用、テスト用、本番用など用途別に AWS アカウントを作成
```

- OU（組織単位）を定義し、各用途に分ける（例：Dev, Test, Prod）

---

###✅ ステップ3：IAM Identity Center (旧 SSO) の設定

| 作業 | 例 |
|------|-----|
| Identity Center を有効化 | 管理アカウントから「IAM Identity Center」にアクセスし有効化 |
| グループとユーザーを作成 | "Developers", "Admins" グループを作成し、ユーザーを所属させる |
| アカウントと権限セットを紐づける | "Developers" は ReadOnly、"Admins" は AdministratorAccess 権限セットを割り当てる |

---

###✅ ステップ4：サービスコントロールポリシー (SCP) による制限

```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Deny",
    "Action": "*",
    "Resource": "*",
    "Condition": {
      "StringNotEquals": {
        "aws:RequestedRegion": ["ap-northeast-1"]
      }
    }
  }]
}
```

- 東京リージョン以外の操作を拒否する例

---

## ✅ ステップ5：CloudTrail ＆ GuardDuty による監視の有効化

- CloudTrail → すべてのアカウントで有効化し、証跡をS3に保存
- GuardDuty → 各アカウントで有効化し、脅威検知ログを一括管理アカウントに集約

---

## ✅ ステップ6：コストと予算の制御

| ツール | 説明 |
|--------|------|
| AWS Budgets | 月額上限を設定し、超過しそうな時に通知 |
| Cost Explorer | サービス別・アカウント別のコスト確認 |
| 請求アラート | SNS + CloudWatch でしきい値通知設定

---

## ✅ ステップ7：ベストプラクティスとおすすめ設定

- IAM ポリシーは最小権限で設計
- アクセスキーの使用は避け、可能な限り IAM ロールや CLI+SSO を使用
- EC2 のデフォルト VPC を利用する前にネットワーク設計を見直す
- Tag（Name/Environment/Owner）をルール化してすべてのリソースに付ける

---

## 📌 まとめ：初期導入構成テンプレート

| 項目 | 推奨設定 |
|------|----------|
| アカウント構成 | Organizations + OU + Identity Center |
| アクセス管理 | IAM Identity Center + Permission Sets |
| 監査ログ | CloudTrail + GuardDuty |
| 制限ルール | SCP による統制（リージョン・サービス） |
| コスト管理 | Budgets + Cost Explorer |

---

この構成で、企業としてセキュリティ・可視性・運用性を確保した AWS 利用をスタートできます。

