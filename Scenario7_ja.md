
# マルチアカウント認証・認可設計：スケーラブルかつネイティブに構成するための出発点

---

## 📘 Scenario（シナリオ）

ある企業は AWS Organizations を使用して複数の AWS アカウントを統合管理しており、すでに IAM Identity Center（旧 AWS SSO）を有効化しています。  
セキュリティエンジニアは、全社的なユーザーアクセス管理を行う必要があります。

- 追加のユーザー管理用インフラ（例：Active Directory）は導入したくない
- 各従業員の職能に応じたアクセス権限を割り当てたい
- スケーラブルかつ一元的に管理できる仕組みを求めている

---

## 🧠 重要ポイント

| 項目 | 説明 |
|------|------|
| ✅ フルマネージド型 | AWS が提供する Identity Center を使うことで、追加構築なく構成可能 |
| ✅ 一元的なユーザー管理 | IAM Identity Center でユーザーとグループを直接管理可能 |
| ✅ ジョブベースの認可 | 各グループに対し Permission Set を定義し、アカウントロールに紐付け |
| ✅ ユーザーポータル | 各ユーザーはポータルから自身に割り当てられたアカウント・ロールへアクセス可能 |
| ✅ AWS Organizations との統合 | アカウント追加時も Identity Center 側で統一的に権限管理ができる |

---

## ✅ 対応方法のまとめ（設計出発点）

### 1. IAM Identity Center のデフォルトディレクトリを使用する

- ユーザーとグループを IAM Identity Center 内で作成・管理
- 外部のディレクトリ（AD Connector、Microsoft ADなど）は不要

### 2. グループと Permission Set を紐付けて各アカウントへ割り当て

- 各グループに対し、ジョブファンクションに基づいた権限セット（Permission Set）を定義
- AWS Organizations のアカウントに対し、グループ単位で権限をマッピング

### 3. ユーザーポータルからのアクセスを推奨

- 従業員は IAM Identity Center のポータルから各 AWS アカウントにアクセス
- ロールの選択、SSO ログイン、セッション管理が簡単に行える

---

## 🚫 避けるべき方法

### 1. オンプレミスまたは外部ディレクトリへの依存

- AD Connector や AWS Managed Microsoft AD を使うと、ディレクトリの保守や接続構成が発生
- 「追加のユーザー管理インフラを使わない」という前提に反する

### 2. IAM ユーザーとの直接マッピング

- Identity Center は IAM ユーザーとの直接リンクを想定しておらず、非効率かつ運用ミスの原因となる
- モダンなアクセス制御には Permission Set + ロール割り当てが基本

---

## 🛠️ 実装例

### IAM Identity Center の初期セットアップ

1. AWS Organizations を有効にしておく
2. IAM Identity Center を有効化し、デフォルトディレクトリを選択
3. IAM Identity Center 上でユーザー・グループを作成
4. 各グループに対し、必要な Permission Set を定義（例: 管理者、開発者、監査者など）
5. Permission Set を AWS アカウントにマッピング

---

## 📌 結論

- ✅ AWS ネイティブな機能（IAM Identity Center）を最大限に活用し、
  **追加構成不要・一元管理・スケーラブル・セキュア** な認証認可基盤を構築可能。
- ✅ 「外部ディレクトリに頼らない構成」として、最小コスト・最小運用負荷で展開できる最良の選択肢。
