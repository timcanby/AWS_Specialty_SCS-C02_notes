
#  AWS Organizations × マルチアカウントセキュリティ監視・自動修復設計ドキュメント

---

## 📘 シナリオ

企業は AWS Organizations を使用し、複数の AWS アカウントに分散された本番ワークロードを運用している。  
セキュリティエンジニアは、以下のようなセキュリティ監視基盤を設計する必要がある：

- 🔍 **すべての本番アカウントでの不審な動作を事前に検知（プロアクティブ監視）**
- ⚙️ **インシデントが発生した場合に自動で修復を実行**
- 📩 **重大なセキュリティファインディング発生時に SNS 経由で通知**
- 📁 **すべてのセキュリティログを専用のログ収集アカウントに送信**

---

## 🧠 設計要件と検討軸

| 要件 | 説明 |
|------|------|
| ✅ 複数アカウント対応 | AWS Organizations による一元管理・連携 |
| ✅ 統合ログ管理 | 専用ログ収集アカウントにセキュリティデータを集約 |
| ✅ 自動修復 | Lambda や Systems Manager を使ったインシデント対応 |
| ✅ 重大度の高い検出に対する通知 | SNS による即時通知と外部システム連携可能性 |
| ✅ 拡張性 | アカウント追加や検出ロジック変更に柔軟に対応可能であること |

---

## ✅ 最適な構成

### **D. AWS Security Hub + EventBridge + Lambda + SNS の構成**

| 要素 | 説明 |
|------|------|
| 🔒 **Security Hub** | 各本番アカウントに有効化。脅威の統合検出・管理を実現。 |
| 🔁 **集約アカウントでの統合** | セキュリティファインディングを集約用アカウントに統合管理 |
| ⚡ **EventBridge + Lambda** | Security Hub の検出イベントをトリガーに Lambda を実行し自動修復 |
| 🔔 **SNS 通知** | Lambda 内で SNS に通知を送信し、即時にセキュリティ担当者へアラート |

---

## 🔍 GuardDuty 単独構成の限界と盲点

GuardDuty は非常に強力な脅威検出サービスですが、**対応できない領域や盲点**が存在するため、それ単独ではセキュリティ監視が不十分となるケースがあります。

### ❗ GuardDuty の主な盲点と補足

| 分類 | 説明 |
|------|------|
| IAM 設定ミスの検出 | GuardDuty は IAM ポリシーの過剰許可や誤設定などを直接検出できない |
| S3 パブリック設定 | バケットがパブリックになっている場合も、GuardDuty は通知しない（Security Hub + S3 保護ルールが必要） |
| OS レベルの異常 | GuardDuty は OS 内部の不審なプロセスやログイン履歴などは検出できない（Inspector や CloudWatch Logs が補完） |
| 長期的傾向の異常検出 | GuardDuty は主にリアルタイムな振る舞いを検知するが、行動傾向やポリシー継続的な逸脱には弱い（Security Hub や Config と連携必要） |
| アプリケーション層攻撃 | HTTP レイヤーの脆弱性攻撃などは GuardDuty では検知できない（WAF や Inspector Advanced の活用が必要） |

---

## 🧭 なぜ Security Hub との統合が必要か

Security Hub は以下のような役割で GuardDuty を補完・拡張します：

- ✅ **Security Best Practices の定期評価（CIS など）**
- ✅ **S3 / IAM / EBS / VPC に関する構成リスク検出**
- ✅ **AWS Config ルールや Inspector、Macie など他サービスとの統合**
- ✅ **重大度別の一元ビューと EventBridge アクション連携**

---

## ✅ 推奨構成：GuardDuty + Security Hub + EventBridge + Lambda + SNS

このような複合構成により、**リアルタイム検知（GuardDuty）と構成監査・リスクスコアリング（Security Hub）を統合**し、マルチアカウント環境におけるセキュリティギャップを最小限に抑えることができます。

